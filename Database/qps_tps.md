# 衡量数据库性能也许真的很烦

## QPS 与 TPS
>QPS: Queries Per Second  
>TPS: Transactions Per Second  

QPS与TPS的概念，按照英文解释，很可能是来自于数据库，而现在更多地被应用到其他领域，比如说描述网站的访问情况。  

#### Q1、QPS和TPS的差异在哪里？
A：Cindy给了我一个很好的例子，来解释QPS和TPS的含义和异同。  

>"QPS 基本类似于 TPS，但是不同的是，对于一个页面的一次访问，形成一个 TPS；但一次页面请求，可能产生多次对服务器的请求，服务器对这些请求，就可计入“QPS”之中。  
 例如，访问一个 Index 页面会请求服务器 3 次，包括一次 html，一次 css，一次 js，那么访问这一个页面就会产生一个“T”，产生三个“Q”。"  

我认为Cindy的例子很好地解释了什么是QPS和TPS的概念。在数据库里面怎么套用这两个概念呢？按照另一个大佬的说法，就是要"具体例子具体分析"。
理论上，写入数据库和查询数据库都属于"一次操作"，都可以使用"事务"（Transactions）来描述，**所以说，写入和查询都用TPS描述，个人认为并没有任何问题**。   
**在一次事务里面只有一次请求的情况下，QPS就可以看做跟TPS相等的意思。**  
   

#### Q2、QPS或TPS无法体现数据负载，该如何解决？
但是问题又来了，无论QPS还是TPS，实际上都是描述"每秒多少次 写入/查询"，都是无法反应出其负载情况的，假如每次请求携带的数据量大小不一，会导致最终的QPS或TPS差别很大。那么这种情况如何解决呢？

A：有两个方法  
方法1：**在相同语境下，对比QPS或者TPS**。比如，**在influxdb-comparise的devops案例下，我的数据库写入TPS是10w**。   
方法2：**使用数据量每秒的概念，去替代QPS或者TPS**。比如，**我的数据库写入性能10MB/s**。
  
#### 总结
1、在一次事务里面只有一次请求的情况下，QPS就可以看做跟TPS相等的意思  
2、写入和查询都用TPS描述，个人认为没有任何问题  
3、使用QPS或者TPS描述数据库性能的时候，需要在一定的语境底下，不然都是耍流氓（在某某测试工具某某案例底下，我的QPS是多少）    
4、描述数据库处理数据量的能力的时候，可以使用每秒数据处理量的概念来描述，比如10MB/s    


  
  
## BDC-TS的指标如何定义
在信通院BDC-TS测试中，我建议，两类场景分别使用下面的指标和语义来描述  
#### 1、写入数据性能指标
指标：TPS、耗时、每秒数据处理量  
(例子：在BDC-TS测试中，实时写入案例里，CTSDB数据库写入TPS为11w，写入总耗时为2300s，每秒数据处理量为10MB/s)  
#### 2、查询数据性能指标
指标：耗时  
(例子：在BDC-TS测试中，查询案例1里，CTSDB数据库查询总耗时1800s)  
  
如果可能，还可以参考阿里的报告格式加入耗时百分比，这样的数据描述更为精准和公平（具体原因后续在这个文章里面会补充）。  
![avatar](https://github.com/gdchaochao/gdchaochao.github.io/blob/master/Database/res/20190723091536.png)


## Thanks
感谢我们鹅厂大佬的指点。很多概念没有实践和积累根本没法知晓。里面很多观点和知识都是来自鹅厂大佬，拜谢。  
其他参考：  
https://help.aliyun.com/document_detail/113368.html  
